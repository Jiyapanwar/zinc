#!/bin/bash

# Define color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Function to check if a command exists
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

# Function to run chkrootkit
run_chkrootkit() {
    echo -e "${CYAN}Running chkrootkit...${NC}"
    if command_exists chkrootkit; then
        chkrootkit_output=$(chkrootkit)
        echo "$chkrootkit_output"
    else
        echo -e "${RED}chkrootkit is not installed. Please install it to proceed.${NC}"
    fi
}

# Function to run rkhunter
run_rkhunter() {
    echo -e "${CYAN}Running rkhunter...${NC}"
    if command_exists rkhunter; then
        rkhunter --update  # Update rkhunter database
        rkhunter_output=$(rkhunter --check --skip-keypress)
        echo "$rkhunter_output"
    else
        echo -e "${RED}rkhunter is not installed. Please install it to proceed.${NC}"
    fi
}

# Function to summarize results
summarize_results() {
    echo -e "${BLUE}Summary of Malware and Rootkit Detection:${NC}"
    echo "=============================================="
    echo ""

    # Check chkrootkit results
    if [[ "$chkrootkit_output" == "not infected" ]]; then
        echo -e "${GREEN}No rootkits found by chkrootkit.${NC}"
    else
        echo -e "${RED}Potential rootkits detected by chkrootkit:${NC}"
        echo "$chkrootkit_output"
    fi

    echo ""

    # Check rkhunter results
    if [[ "$rkhunter_output" == "No warnings found" ]]; then
        echo -e "${GREEN}No issues found by rkhunter.${NC}"
    else
        echo -e "${RED}Potential issues detected by rkhunter:${NC}"
        echo "$rkhunter_output" | grep -E "Warning|Possible|Infected"
    fi

    echo ""
    echo -e "${YELLOW}Please review the above results carefully and take appropriate actions if necessary.${NC}"
}

# Main script execution
echo -e "${BLUE}Malware and Rootkit Detection Script${NC}"
echo "=============================================="
echo ""

# Run chkrootkit
run_chkrootkit

# Run rkhunter
run_rkhunter

# Summarize results
summarize_results

echo "=============================================="
echo -e "${CYAN}End of Malware and Rootkit Detection.${NC}"